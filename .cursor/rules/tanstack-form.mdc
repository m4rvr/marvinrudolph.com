---
alwaysApply: true
description: Enforce exclusive use of TanStack Form for all form handling
---

# TanStack Form Usage Guidelines

**TanStack Form is the ONLY library allowed for form handling in this codebase.** Never use any other form libraries (React Hook Form, Formik, etc.).

## Core Patterns

### Form Creation
```typescript
import { useForm } from '@tanstack/react-form'

const form = useForm({
  defaultValues: {
    firstName: '',
    lastName: '',
  },
  onSubmit: async ({ value }) => {
    // Handle form submission
    console.log(value)
  },
})
```

### Field Rendering
```typescript
<form.Field
  name="firstName"
  validators={{
    onChange: ({ value }) =>
      !value
        ? 'A first name is required'
        : value.length < 3
          ? 'First name must be at least 3 characters'
          : undefined,
    onChangeAsyncDebounceMs: 500,
    onChangeAsync: async ({ value }) => {
      // Async validation logic
      return value.includes('error') && 'No "error" allowed in first name'
    },
  }}
  children={(field) => (
    <>
      <label htmlFor={field.name}>First Name:</label>
      <input
        id={field.name}
        name={field.name}
        value={field.state.value}
        onBlur={field.handleBlur}
        onChange={(e) => field.handleChange(e.target.value)}
      />
      <FieldInfo field={field} />
    </>
  )}
/>
```

### Form Submission
```typescript
<form
  onSubmit={(e) => {
    e.preventDefault()
    e.stopPropagation()
    form.handleSubmit()
  }}
>
  {/* Form fields */}
  <form.Subscribe
    selector={(state) => [state.canSubmit, state.isSubmitting]}
    children={([canSubmit, isSubmitting]) => (
      <button type="submit" disabled={!canSubmit}>
        {isSubmitting ? '...' : 'Submit'}
      </button>
    )}
  />
</form>
```

## State Management

### Reactive State Access
```typescript
// For specific values
const firstName = form.useStore((state) => state.values.firstName)

// For form state
<form.Subscribe
  selector={(state) => ({
    canSubmit: state.canSubmit,
    isSubmitting: state.isSubmitting,
  })}
  children={(state) => (
    <button type="submit" disabled={!state.canSubmit}>
      {state.isSubmitting ? '...' : 'Submit'}
    </button>
  )}
/>
```

### Field Metadata
```typescript
const { isTouched, isDirty, isPristine, isBlurred } = field.state.meta
const { errors, isValidating } = field.state.meta
```

## Validation Rules

### Synchronous Validation
```typescript
validators={{
  onChange: ({ value }) => {
    if (!value) return 'This field is required'
    if (value.length < 3) return 'Must be at least 3 characters'
    return undefined
  }
}}
```

### Asynchronous Validation
```typescript
validators={{
  onChangeAsyncDebounceMs: 500,
  onChangeAsync: async ({ value }) => {
    const response = await validateUniqueness(value)
    return response.isUnique ? undefined : 'Value must be unique'
  }
}}
```

## Error Handling

### Field Error Display
```typescript
function FieldInfo({ field }: { field: AnyFieldApi }) {
  return (
    <>
      {field.state.meta.isTouched && !field.state.meta.isValid ? (
        <em>{field.state.meta.errors.join(', ')}</em>
      ) : null}
      {field.state.meta.isValidating ? 'Validating...' : null}
    </>
  )
}
```

## Key Principles

1. **Type Safety**: TanStack Form provides full TypeScript support
2. **Headless**: No UI components, just state management
3. **Framework Agnostic**: Works with React, Vue, Solid, Angular, etc.
4. **Performance**: Optimized re-renders with subscription-based updates
5. **Accessibility**: Follow standard HTML form patterns

## Forbidden Patterns

❌ **DO NOT USE:**
- React Hook Form
- Formik
- Redux Form
- Final Form
- Any other form library

❌ **DO NOT:**
- Use uncontrolled components with TanStack Form
- Mix form libraries within the same form
- Create custom form state management

## Best Practices

✅ **ALWAYS:**
- Use TypeScript interfaces for form values
- Implement proper validation (sync and async as needed)
- Handle form submission with `form.handleSubmit()`
- Use `form.Subscribe` for reactive state updates
- Display validation errors appropriately
- Follow accessibility guidelines for form elements
- Use Zod schema for validation

✅ **CONSIDER:**
- Debouncing async validation for performance
- Using field metadata for conditional rendering
- Grouping related fields when appropriate
